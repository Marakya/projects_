### Обнаружение точки изменения (Change Poin Detection/CPD) 

CPD основан на обнаружении резких сдвигов в тенденциях временных рядов и отлично подходит для следующих случаев: 

- Обнаружение аномальных последовательностей / состояний во временном ряду 

- Обнаружение средней скорости уникальных состояний во временном ряду 

- Обнаружение внезапного изменения состояния временного ряда в реальном времени 

Существует две категории обнаружения точек изменения - оффлайн и онлайн. 

#### Оффлайн подход 

- Все данные получены и обработаны одновременно 

- Все изменения представляют интерес, а не только самые последние изменения в последовательности 

Такие подходы анализируют весь временной ряд, и они, как правило, более точные 

#### Онлайн подход 

В отличие от автономного обнаружения точек изменения, интерактивное обнаружение точек изменения используется для временных рядов потокового вещания, обычно для постоянного мониторинга или немедленного обнаружения аномалий. В режиме онлайн отдельные точки данных обрабатываются по мере их появления с целью обнаружения изменений состояния, как только они происходят. Есть несколько характеристик онлайн обнаружения точки изменения: 

- Быстрая обработка «на лету», чтобы быстро оценить сдвиги в динамике временных рядов 

- Оценка только самых последних изменений во временном ряду, а не предыдущих изменений 

##### В данной работе рассмотрим две библиотки:

- Пакет ruptures, библиотека Python для выполнения автономного обнаружения точки изменения
- Пакет changefinder, библиотека Python для онлайн-определения точки изменения

### The Ruptures Module 

Пакет предлагает различные методы поиска (двоичная сегментация, Pelt, обнаружение изменений на основе окон, динамическое программирование и т.д.)

При моделировании временных рядов мы пытаемся найти базовую закономерность, например, линию регрессии, чтобы мы могли прогнозировать будущее. Но линия регрессии не будет прямой, если есть точки изменения. Поэтому интуитивный алгоритм заключается в построении сегментированных линий регрессии, где точки перегиба - это точки изменения. 

Линия регрессии в (B) разрезается на две линии регрессии в точке изменения. Сумма расстояний в (B) намного меньше, чем в (A). Перемещая точку разреза слева направо по временному ряду, алгоритм может найти соответствующую точку изменения временного ряда, которая минимизирует сумму расстояний или ошибок 

Данный метод основан на сдвиге среднего значений. Среднее значение постоянно в пределах каждого сегмента и меняется на новое значение в каждой точке изменения.

![image](https://user-images.githubusercontent.com/113238801/203793700-a1466bca-ccfc-48b3-b089-01e1a35acc84.png)

Результат:

![image](https://user-images.githubusercontent.com/113238801/203793939-138b23ca-e450-4a76-8e1a-c7afa0d9827e.png)

### The changefinder Module

Временной ряд может быть охарактеризован авторегрессионным (AR) скользящим средним процессом. Согласно модели AR, следующая точка данных является взвешенным скользящим средним прошлых точек данных со случайным шумом, как в следующем уравнении

![image](https://user-images.githubusercontent.com/113238801/203794662-b203df58-8461-4988-b6ac-16fa6018a6ee.png)

Если есть точка изменения, то ожидается, что процессы AR до и после точки изменения будут отличаться. Исходя из этой интуиции, Yamanishi & Takeuchi [5] предложили алгоритм обучения Sequentially Discounting AutoRegressive (SDAR). Метод SDAR состоит из двух фаз обучения. На первой фазе обучения он производит промежуточную оценку, называемую оценкой аномалии. На втором этапе обучения он производит оценку точки изменения, которая может обнаружить точку изменения.

Алгоритм может быть описан следующим образом:
[1 AR модель] Рассматриваем фрагмент данных t = 1, ..., N, затем строим AR (авторегрессионную) модель. Затем алгоритм выдает “оценку аномалии”, которая представляет собой разницу между прогнозируемым значением AR для Xt и фактическими данными Xt. Обратите внимание, что на этом шаге берется только N точек данных. Поскольку онлайн подход не использует всю историю целиком, он настроен на онлайн-поток данных. 

[1-е Сглаживание] Вышеуказанный показатель аномалии будет очень изменчивым и будет давать ложные сигналы. Алгоритм генерирует скользящую среднюю Yt для оценки аномалии, чтобы сгладить выбросы. 

[2-я AR модель] Создается модель AR для Yt и создайте еще один “показатель аномалии” на основе недавно построенной модели AR и Yt. 

[2-е сглаживание] Аналогично, новая оценка аномалии имеет тенденцию быть изменчивой. Алгоритм генерирует скользящую среднюю для сглаживания. Конечным результатом является оценка, называемая точкой изменения, как показано на рисунке ниже. 

![image](https://user-images.githubusercontent.com/113238801/203795991-b6136b44-8a7c-4dd8-b095-746c1115b296.png)

Результат:

![image](https://user-images.githubusercontent.com/113238801/203796054-eeb64dde-6755-4444-8e51-43fff7a1f04f.png)

